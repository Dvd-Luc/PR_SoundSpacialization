"use strict";(self["webpackChunkpr_spacialization"]=self["webpackChunkpr_spacialization"]||[]).push([[920],{607:(t,o,e)=>{e.d(o,{Z:()=>m});e(71);var i=e(3673),n=e(2323);const a={id:"app"},s=(0,i.Uk)(" Let us locate you for better results... "),r={key:0},l={key:1},c=(0,i._)("i",null,"Getting your location...",-1),d=[c],u={key:2};function h(t,o,e,c,h,g){return(0,i.wg)(),(0,i.iD)("div",a,[(0,i._)("p",null,[s,(0,i._)("button",{onClick:o[0]||(o[0]=(...t)=>g.locateMe&&g.locateMe(...t))},"Get location")]),t.errorStr?((0,i.wg)(),(0,i.iD)("div",r," Sorry, but the following error occurred: "+(0,n.zw)(t.errorStr),1)):(0,i.kq)("",!0),t.gettingLocation?((0,i.wg)(),(0,i.iD)("div",l,d)):(0,i.kq)("",!0),t.location?((0,i.wg)(),(0,i.iD)("div",u," Your location data is "+(0,n.zw)(t.location.coords.latitude)+", "+(0,n.zw)(t.location.coords.longitude),1)):(0,i.kq)("",!0)])}e(6701);const g={name:"Localisation",data:function(){return{location:null,orientation:null,gettingLocation:!1,errorStr:null}},mounted:()=>{console.log("huhuhuhu")},computed:{dispOrientation(){return this.orientation}},methods:{async getLocation(){return new Promise(((t,o)=>{"geolocation"in navigator||o(new Error("Geolocation is not available.")),navigator.geolocation.getCurrentPosition((o=>{t(o)}),(t=>{o(t)}))}))},async getOrientation(){if(!window.DeviceOrientationEvent)throw console.log("Orientation not available"),new Error("Orientation not available on this device");window.addEventListener("deviceorientation",(t=>{console.log("z : "+t.alpha+"\n x : "+t.beta+"\n y : "+t.gamma+"\n abs"+t.absolute),this.orientation=Math.random()}))},async locateMe(){this.gettingLocation=!0;try{this.gettingLocation=!1,this.location=await this.getLocation()}catch(t){this.gettingLocation=!1,this.errorStr=t.message}},async orientateMe(){try{this.orientation=await this.getOrientation(),console.log(this.orientation)}catch(t){this.errorStr=t.message}}}};var p=e(4260);const L=(0,p.Z)(g,[["render",h]]),m=L},8920:(t,o,e)=>{e.r(o),e.d(o,{default:()=>_});var i=e(3673);const n={class:"boombox-body"},a={class:"bb-front"},s=(0,i._)("section",{class:"master-controls"},[(0,i._)("input",{type:"range",id:"volume",class:"control-volume",min:"0",max:"2",value:"1",list:"gain-vals",step:"0.01","data-action":"volume"}),(0,i._)("datalist",{id:"gain-vals"},[(0,i._)("option",{value:"0",label:"min"}),(0,i._)("option",{value:"2",label:"max"})]),(0,i._)("label",{for:"volume"},"Volume")],-1),r={class:"tape"},l={ref:"audioPlayer",src:"https://s3-us-west-2.amazonaws.com/s.cdpn.io/858/outfoxing.mp3",crossorigin:"anonymous"},c=(0,i._)("span",null,"Play/Pause the spacialized experience",-1),d=(0,i._)("div",{id:"show position","aria-labelledby":"move-boombox"},null,-1),u={id:"source-position","aria-labelledby":"set-source-positions"},h=(0,i._)("h3",{id:"set-source-position"},"Set GPS source position",-1),g={class:"row q-col-gutter-sm"},p={class:"column"},L={class:"column"};function m(t,o,e,m,v,w){const f=(0,i.up)("q-btn"),b=(0,i.up)("q-input"),S=(0,i.up)("Localisation"),M=(0,i.up)("q-page");return(0,i.wg)(),(0,i.j4)(M,null,{default:(0,i.w5)((()=>[(0,i._)("div",n,[(0,i._)("div",a,[s,(0,i._)("section",r,[(0,i._)("audio",l,null,512),(0,i.Wm)(f,{onClick:o[0]||(o[0]=t=>w.playMusic()),color:"white","text-color":"black"},{default:(0,i.w5)((()=>[c])),_:1})])])]),d,(0,i._)("div",u,[h,(0,i._)("div",g,[(0,i._)("div",p,[(0,i.Wm)(b,{standout:"",modelValue:v.gpsSourceLocation.deg.latitude,"onUpdate:modelValue":o[1]||(o[1]=t=>v.gpsSourceLocation.deg.latitude=t),onChange:o[2]||(o[2]=t=>w.updateSourceLocationRad()),label:"Source latitude"},null,8,["modelValue"])]),(0,i._)("div",L,[(0,i.Wm)(b,{standout:"",modelValue:v.gpsSourceLocation.deg.longitude,"onUpdate:modelValue":o[3]||(o[3]=t=>v.gpsSourceLocation.deg.longitude=t),label:"Source longitude"},null,8,["modelValue"])])])]),(0,i.Wm)(S)])),_:1})}e(6701);var v=e(607);const w={name:"Spacialization",data(){return{gpsTracker:null,audioCtx:null,listener:null,track:null,gainNode:null,gpsListenerLocation:{deg:null,rad:null},gpsSourceLocation:{deg:{latitude:0,longitude:0},rad:{latitude:0,longitude:0}},positionListener:{X:0,Y:0,Z:0},position:{X:0,Y:0,Z:0},orientationListener:{forwardX:0,forwardY:1,forwardZ:0,upX:0,upY:0,upZ:1},orientationSourceRad:{X:0,Y:0,Z:-1},pannerSettings:{pannerModel:"HRTF",innerCone:360,outerCone:0,outerGain:0,distanceModel:"inverse",maxDistance:100,refDistance:1,rollOff:1,positionX:0,positionY:0,positionZ:0,orientationX:0,orientationY:0,orientationZ:1},panner:null}},components:{Localisation:v.Z},methods:{error(t){console.warn("ERROR("+t.code+"): "+t.message)},init(){if(console.log("init method"),console.log(this.getDistanceFromGPSinKm(45.7703307,4.880336,45.7867264,4.8726016)),"geolocation"in navigator){const t={enableHighAccuracy:!1,timeout:5e3,maximumAge:0};this.gpsTracker=navigator.geolocation.watchPosition(this.updateCartesianListenerPosition,this.error,t)}else console.log("No Geolocation available");if(!window.DeviceOrientationEvent)throw console.log("Orientation not available"),new Error("Orientation not available on this device");console.log(this.listener),this.panner=new PannerNode(this.audioCtx,this.pannerSettings),console.log(this.panner),this.track=this.audioCtx.createMediaElementSource(this.$refs.audioPlayer);const t=this.audioCtx.createGain(),o=document.querySelector('[data-action="volume"]');o.addEventListener("input",(function(){t.gain.value=this.value}),!1),this.track.connect(t).connect(this.panner).connect(this.audioCtx.destination)},updateSourceLocationRad(){this.gpsSourceLocation.rad.latitude=this.deg2rad(this.gpsSourceLocation.deg.latitude),this.gpsSourceLocation.rad.longitude=this.deg2rad(this.gpsSourceLocation.deg.longitude)},updateListener(t,o){switch(console.log("updateListener"),console.log(t),console.log(o),t){case"X":this.listener.positionX.value=o;break;case"Y":this.listener.positionY.value=o;break;case"Z":this.listener.positionZ.value=o;break}},async playMusic(){if(!this.audioCtx){const t=window.AudioContext||window.webkitAudioContext;console.log(this.listener),this.audioCtx=new t,this.listener=this.audioCtx.listener,this.init()}"running"===this.audioCtx.state?this.$refs.audioPlayer.paused?this.$refs.audioPlayer.play():this.$refs.audioPlayer.pause():console.error("audio context down"),"suspended"===this.audioCtx.state&&this.audioCtx.resume()},getDistanceFromGPSinKm(t,o,e,i){var n=6371,a=this.deg2rad(e-t),s=this.deg2rad(i-o),r=Math.sin(a/2)*Math.sin(a/2)+Math.cos(this.deg2rad(t))*Math.cos(this.deg2rad(e))*Math.sin(s/2)*Math.sin(s/2),l=2*Math.atan2(Math.sqrt(r),Math.sqrt(1-r)),c=n*l;return c},deg2rad(t){return t*(Math.PI/180)},updateListenerGeoloc(t){var o={latitude:t.coords.latitude,longitude:t.coords.longitude},e={latitude:this.deg2rad(o.latitude),longitude:this.deg2rad(o.longitude)};this.gpsListenerLocation.deg=o,this.gpsListenerLocation.rad=e},updateCartesianListenerPosition(t){var o=6371e3;this.updateListenerGeoloc(t);var e=this.gpsSourceLocation.rad.latitude,i=this.gpsSourceLocation.rad.longitude,n=this.gpsListenerLocation.rad.latitude,a=this.gpsListenerLocation.rad.longitude,s={X:o*(Math.cos(e)*Math.sin(i)-Math.cos(n)*Math.sin(a)),Y:o*(Math.sin(e)*Math.sin(i)-Math.sin(n)*Math.sin(a)),Z:o*(Math.cos(e)-Math.cos(n))};console.log("Difference Cartesian : "),console.log(s),this.positionListener.X=s.X,this.updateListener("X",this.positionListener.X),this.positionListener.Y=s.Y,this.updateListener("Y",this.positionListener.Y),this.positionListener.Z=s.Z,this.updateListener("Z",this.positionListener.Z),console.log("Source GPS : "),console.log(this.gpsSourceLocation),console.log("Listener GPS : "),console.log(this.gpsListenerLocation),console.log("Difference Cartesian"),console.log(s),console.log("Position Listener"),console.log(this.positionListener)},updateCartesianListenerOrientation(t){console.log("UpdateCartesianListener");var o=this.deg2rad(t.alpha),e=this.deg2rad(t.gamma);this.orientationListener.forwardX=Math.sin(e)*Math.cos(o),this.listener.forwardX.value=this.orientationListener.forwardX,this.orientationListener.forwardY=Math.sin(e)*Math.sin(o),this.listener.forwardY.value=this.orientationListener.forwardY,this.orientationListener.forwardZ=Math.cos(e),this.listener.forwardZ.value=this.orientationListener.forwardZ}}};var f=e(4260),b=e(4379),S=e(8902),M=e(7435),y=e(8786),C=e(7518),Z=e.n(C);const x=(0,f.Z)(w,[["render",m]]),_=x;Z()(w,"components",{QPage:b.Z,QSlider:S.Z,QBtn:M.Z,QInput:y.Z})}}]);